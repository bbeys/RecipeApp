extends layout

block content
  header
    h1 Search recipes
    nav
      // always show 'All recipes' in the header
      a.button(href='/recipes') All recipes
      if !locals.user
        a(href='/login') Login
      else
        span Hello #{locals.user.name}
        a(href='/dashboard') Dashboard
        a(href='/profile') Profile
        a(href='/logout') Logout
        if locals.user.role === 'admin'
          a(href='/admin/add-recipe') Add recipe

  // For admins: don't show suggested or the search controls â€” show admin summary only
  if locals.user && locals.user.role === 'admin'
    if adminTotals
      section.admin-summary
        h2 Admin summary
        p Total users: #{adminTotals.totalUsers}
        p Total recipes: #{adminTotals.totalRecipes}
    // also show admin quick links
    nav.admin-links
      a.button(href='/dashboard') Admin dashboard
      a.button(href='/admin/recipes') Recipes
      a.button(href='/admin/users') Users
  else
    if suggested
      section.suggested
        h2 Suggested for you
        article.card
          h3= suggested.title
          if suggested.prepTime
            span.badge Prep: #{suggested.prepTime}
          if suggested.cuisine
            span.badge Cuisine: #{Array.isArray(suggested.cuisine)?suggested.cuisine.join(', '):suggested.cuisine}
          p= suggested.instructions

    // search + suggested are shown only to non-admins

    form#searchForm(action='/recipes' method='get')
      fieldset
        legend Ingredients (select any)
        each ingredient in ingredients
          label
            input(type='checkbox' name='ingredients' value=ingredient)
            | #{ingredient}

    fieldset
      legend Preferences
      div
        label Dietary:
        each d in dietary
          label
            input(type='checkbox' name='dietary' value=d)
            | #{d}

      div
        label Meal Type (exact match):
        select(name='mealType' multiple)
          each m in mealTypes
            option(value=m)= m

      div
        label Cuisine (exact match):
        select(name='cuisine' multiple)
          each c in cuisines
            option(value=c)= c

      div
        label Prep Time:
        select(name='prepTime')
          option(value='') Any
          each p in prepTimes
            option(value=p)= p

      // Show recipes button should always be enabled (submit by default so fallback works)
      button#showBtn(type='submit') Show recipes

block scripts
  script(src='/js/search.js')